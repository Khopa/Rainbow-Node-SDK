{
    "describe": "PRESENCE API", 
     "starring": {
        "admin": {
            "robert": {
                "email": "rford@westworld.com",
                "password": "Password_123",
                "firstname": "Robert",
                "lastname": "Ford",
                "company": "Westworld Host"
            }
        },
        "actors": {
            "clementine": {
                "email": "cpennyfeather@host-westworld.com",
                "firstname": "Clementine",
                "lastname": "Pennyfeather",
                "company": "Westworld Host",
                "password": "Password_123"
            },
            "elsie": {
                "email": "ehughes@guest-westworld.com",
                "firstname": "Elsie",
                "lastname": "Hughes",
                "company": "Westworld Guest",
                "password": "Password_123"
            }
        },
        "relations": [
            {
                "isCompanyVisibleBy": {
                    "Westworld Host": "Westworld Guest"
                }
            },
            {
                "isActorInRelationWith": {
                    "ehughes@guest-westworld.com": "cpennyfeather@host-westworld.com"
                }
            }
        ]
    },
    "run": [
        
        {
            "it": {
                "should": "log-in with Clementine and check that her presence is online",
                "by": [
                    {
                        "executing": "api:connection.signin", 
                        "injecting": ["usr:clementine.email", "usr:clementine.password"], 
                        "resulting": "account", 
                        "expecting": [{"var:account.account.userId": "$defined"}, {"var:account.account.loginEmail": "$defined"}, {"var:account.account.companyId": "$defined"}],
                        "using": ["clementine"]
                    },
                    {
                        "executing": "api:contacts.getConnectedUser", 
                        "injecting": [], 
                        "resulting": "connectedUser", 
                        "expecting": [{"var:connectedUser": "$defined"}, {"var:connectedUser.status": "online"}],
                        "using": ["clementine"]
                    },
                    {
                        "executing": "api:connection.signout", 
                        "injecting": [], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["clementine"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "log-in with Clementine, change her presence to dnd and check that her presence is dnd after receiving the confirmation event from the server",
                "by": [
                    {
                        "executing": "api:connection.signin", 
                        "injecting": ["usr:clementine.email", "usr:clementine.password"], 
                        "resulting": "account", 
                        "expecting": [{"var:account.account": "$defined"}],
                        "using": ["clementine"]
                    },
                    {
                        "executing": "api:presence.setPresenceTo", 
                        "injecting": ["api:presence.RAINBOW_PRESENCE_DONOTDISTURB"], 
                        "resulting": null,
                        "waiting": {
                            "forEvent": "api:presence.RAINBOW_ONPRESENCECHANGED",
                            "resulting": "presence>status",
                            "using": ["clementine"]
                        }, 
                        "expecting": [{"var:presence.status": "dnd"}],
                        "using": ["clementine"]
                    },
                    {
                        "executing": "api:connection.signout", 
                        "injecting": [], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["clementine"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "log-in with Clementine and Elsie, change Clementine's presence to dnd and check that Elsie receives an event with the right presence of Clementine",
                "by": [
                    {
                        "executing": "api:connection.signin", 
                        "injecting": ["usr:@.email", "usr:@.password"], 
                        "resulting": "account", 
                        "expecting": [{"var:account.account": "$defined"}],
                        "using": ["clementine", "elsie"]
                    },
                    {
                        "executing": "api:presence.setPresenceTo", 
                        "injecting": ["api:presence.RAINBOW_PRESENCE_DONOTDISTURB"], 
                        "resulting": null,
                        "waiting": {
                            "forEvent": "api:presence.RAINBOW_ONCONTACTPRESENCECHANGED",
                            "resulting": "presence>status",
                            "using": ["elsie"]
                        }, 
                        "expecting": [{"var:presence.status": "dnd", "for": "elsie"}],
                        "using": ["clementine"]
                    },
                    {
                        "executing": "api:connection.signout", 
                        "injecting": [], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["clementine", "elsie"]
                    }
                ]
            }
        }
    ]
}