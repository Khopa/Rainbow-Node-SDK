{
    "describe": "CONVERSATIONS API", 
    "starring": {
        "admin": {
            "robert": {
                "email": "rford@westworld.com",
                "password": "Password_123"
            }
        },
        "actors": {
            "dolores": {
                "email": "dabernathy@host-westworld.com",
                "firstname": "Dolores",
                "lastname": "Abernathy",
                "company": "Westworld Guest",
                "password": "Password_123"
            },
            "teddy": {
                "email": "tflood@host-westworld.com",
                "firstname": "Teddy",
                "lastname": "Flood",
                "company": "Westworld Guest",
                "password": "Password_123"
            }
        }
    },
    "runBeforeAll": {
        "it": {
            "should": "Log-in with Dolores and Teddy successfully",
            "by": [
                {
                    "executing": "api:connection.signin", 
                    "injecting": ["usr:@.email", "usr:@.password"], 
                    "resulting": "account", 
                    "expecting": [{"var:account": "$defined"}],
                    "using": ["dolores", "teddy"]
                }
            ]
        }
    },   
    "runAfterAll": {
        "it": {
            "should": "Log-out with Dolores and Teddy successfully",
            "by": [
                {
                    "executing": "api:connection.signout", 
                    "injecting": [], 
                    "resulting": null, 
                    "expecting": [],
                    "using": ["dolores", "teddy"]
                }
            ]
        }
    },
    "run": [
        {
            "it": {
                "should": "Return the list of conversation of Dolores and Teddy",
                "by": [
                    {
                        "executing": "api:conversations.getAllConversations", 
                        "injecting": [], 
                        "resulting": "doloresConversations", 
                        "expecting": [{"var:doloresConversations": "$anArray"}, {"var:doloresConversations.length": 0}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:conversations.getAllConversations", 
                        "injecting": [], 
                        "resulting": "teddyConversations", 
                        "expecting": [{"var:teddyConversations": "$anArray"}, {"var:teddyConversations.length": 0}],
                        "using": ["teddy"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "Create a conversation from Teddy to Dolores",
                "by": [
                    {
                        "executing": "api:contacts.searchByLogin", 
                        "injecting": ["usr:dolores.email"], 
                        "resulting": "contact", 
                        "expecting": [{"var:contact.loginEmail": "#dabernathy@host-westworld.com"}],
                        "using": ["teddy"]
                    },
                    {
                        "executing": "api:conversations.openConversationForContact", 
                        "injecting": ["var:contact"], 
                        "resulting": "teddyConversation", 
                        "expecting": [{"var:teddyConversation": "$defined"}],
                        "using": ["teddy"]
                    },
                    {
                        "executing": "api:conversations.getAllConversations", 
                        "injecting": [], 
                        "resulting": "teddyConversations", 
                        "expecting": [{"var:teddyConversations": "$anArray"}, {"var:teddyConversations.length": 1}],
                        "using": ["teddy"]
                    },
                    {
                        "executing": "api:conversations.getConversationById", 
                        "injecting": ["var:teddyConversation.id"], 
                        "resulting": "conversation", 
                        "expecting": [{"var:conversation": "$defined"}],
                        "using": ["teddy"]
                    },
                    {
                        "executing": "api:conversations.closeConversation", 
                        "injecting": ["var:teddyConversation"],
                        "waiting": {
                            "forEvent": "api:conversations.RAINBOW_ONCONVERSATIONREMOVED",
                            "resulting": "conversation>dbId",
                            "using": ["teddy"]
                        },
                        "resulting": "", 
                        "expecting": [],
                        "using": ["teddy"]
                    },
                    {
                        "executing": "api:conversations.getAllConversations", 
                        "injecting": [], 
                        "resulting": "teddyConversations", 
                        "expecting": [{"var:teddyConversations": "$anArray"}, {"var:teddyConversations.length": 0}],
                        "using": ["teddy"]
                    }
                ]
            }
        }
    ]
}