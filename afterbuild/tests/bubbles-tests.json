{
    "describe": "Bubbles API", 
    "starring": {
        "admin": {
            "robert": {
                "email": "rford@westworld.com",
                "password": "Password_123"
            }
        },
        "actors": {
            "dolores": {
                "email": "dabernathy@host-westworld.com",
                "firstname": "Dolores",
                "lastname": "Abernathy",
                "company": "Westworld Host",
                "password": "Password_123"
            },
            "maeve": {
                "email": "mmillay@host-westworld.com",
                "firstname": "Maeve",
                "lastname": "Millay",
                "company": "Westworld Host",
                "password": "Password_123"
            }
        }
    },
    "runBeforeAll": {
        "it": {
            "should": "Log-in with Maeve and Dolores successfully and delete all existing bubbles",
            "by": [
                {
                    "executing": "api:connection.signin", 
                    "injecting": ["usr:@.email", "usr:@.password"], 
                    "resulting": "account", 
                    "expecting": [{"var:account": "$defined"}],
                    "using": ["maeve", "dolores"]
                },
                {
                    "executing": "api:bubbles.deleteAllBubbles", 
                    "injecting": [], 
                    "resulting": "", 
                    "expecting": [],
                    "using": ["maeve", "dolores"]
                }
            ]
        }
    },   
    "runAfterAll": {
        "it": {
            "should": "Log-out with Maeve and Dolores successfully",
            "by": [
                {
                    "executing": "api:connection.signout", 
                    "injecting": [], 
                    "resulting": null, 
                    "expecting": [],
                    "using": ["maeve", "dolores"]
                }
            ]
        }
    },
    "run": [
        {
             "it": {
                "should": "Check that Maeve and Dolores have no bubbles (owned or not)",
                "by": [
                    {
                        "executing": "api:bubbles.getAllOwnedBubbles", 
                        "injecting": [], 
                        "resulting": "ownedBubbles", 
                        "expecting": [{"var:ownedBubbles.length": 0}],
                        "using": ["maeve", "dolores"]
                    },
                    {
                        "executing": "api:bubbles.getAllBubbles", 
                        "injecting": [], 
                        "resulting": "bubbles", 
                        "expecting": [{"var:bubbles.length": 0}],
                        "using": ["maeve", "dolores"]
                    },
                    {
                        "executing": "api:bubbles.getAllPendingBubbles", 
                        "injecting": [], 
                        "resulting": "pendingBubbles", 
                        "expecting": [{"var:pendingBubbles.length": 0}],
                        "using": ["maeve", "dolores"]
                    }
                ]
            }
        },
        {
             "it": {
                "should": "Create a bubble with Maeve, check that the bubble is well created and then delete it",
                "by": [
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description", false], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "A bubble"}, {"var:bubble.desc": "A description"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "bubbleFounded", 
                        "expecting": [{"var:bubbleFounded": "$anObject"}, {"var:bubbleFounded": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubble"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "deletedBubble", 
                        "expecting": [{"var:deletedBubble": "$notDefined"}],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
             "it": {
                "should": "Create a bubble with Maeve, close the conversation associated to this bubble, then reopen the conversation",
                "by": [
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "A bubble"}, {"var:bubble.desc": "A description"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "bubbleFounded", 
                        "expecting": [{"var:bubbleFounded": "$anObject"}, {"var:bubbleFounded": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:conversations.getConversationByBubbleId", 
                        "injecting": ["var:bubbleFounded.dbId"], 
                        "resulting": "conversationbubble", 
                        "expecting": [{"var:conversationbubble": "$anObject"}, {"var:conversationbubble": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:conversations.closeConversation", 
                        "injecting": ["var:conversationbubble"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:conversations.getConversationByBubbleId", 
                        "injecting": ["var:bubbleFounded.dbId"], 
                        "resulting": "conversationbubbleAfterDeleted", 
                        "expecting": [{"var:conversationbubbleAfterDeleted": "$notDefined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:conversations.openConversationForBubble", 
                        "injecting": ["var:bubbleFounded"], 
                        "resulting": "conversationReopened", 
                        "expecting": [{"var:conversationReopened": "$anObject"}, {"var:conversationReopened": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:conversations.getConversationByBubbleId", 
                        "injecting": ["var:bubbleFounded.dbId"], 
                        "resulting": "conversationbubbleAfterReopen", 
                        "expecting": [{"var:conversationbubbleAfterReopen": "$anObject"}, {"var:conversationbubbleAfterReopen": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubble"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "deletedBubble", 
                        "expecting": [{"var:deletedBubble": "$notDefined"}],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
             "it": {
                "should": "Create 5 bubbles with Maeve and remove them all",
                "by": [
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["Bubble 1", "Description of bubble 1"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "Bubble 1"}, {"var:bubble.desc": "Description of bubble 1"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["Bubble 2", "Description of bubble 2"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "Bubble 2"}, {"var:bubble.desc": "Description of bubble 2"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["Bubble 3", "Description of bubble 3"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "Bubble 3"}, {"var:bubble.desc": "Description of bubble 3"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["Bubble 4", "Description of bubble 4"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "Bubble 4"}, {"var:bubble.desc": "Description of bubble 4"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["Bubble 5", "Description of bubble 5"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "Bubble 5"}, {"var:bubble.desc": "Description of bubble 5"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteAllBubbles", 
                        "injecting": [], 
                        "resulting": "", 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getAllBubbles", 
                        "injecting": [], 
                        "resulting": "ownedBubbles", 
                        "expecting": [{"var:ownedBubbles.length": 0}],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "Create a bubble with Maeve, invite Dolores, wait until she receives the event then remove Dolores from this bubble and delete it",
                "by": [
                    {
                        "executing": "api:contacts.searchByLogin", 
                        "injecting": ["usr:dolores.email"], 
                        "resulting": "contact", 
                        "expecting": [{"var:contact": "$anObject"}, {"var:contact.id": "$defined"}, {"var:contact.loginEmail": "#dabernathy@host-westworld.com"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "A bubble"}, {"var:bubble.desc": "A description"}, {"var:bubble.owner": true}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.inviteContactToBubble", 
                        "injecting": ["var:contact", "var:bubble"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED",
                            "resulting": "bubbleWithInvitation>dbId",
                            "using": ["dolores"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [{"var:updatedBubble": "$anObject"}, {"var:updatedBubble.users": "$anArray"}, {"var:updatedBubble.users[0].status": "invited"}, {"var:updatedBubble.users[0].contact.loginEmail": "#dabernathy@host-westworld.com"}, {"var:updatedBubble.users.length": 1}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "bubbleInvited", 
                        "expecting": [{"var:bubbleInvited.users.length": 2}, {"var:bubbleInvited.users[1].status": "invited"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.removeContactFromBubble", 
                        "injecting": ["var:contact", "var:updatedBubble"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleRemovedInvitation>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": "bubbleNoContact", 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleRemovedInvitation.dbId"], 
                        "resulting": "bubbleWithRemovedInvitation", 
                        "expecting": [{"var:bubbleWithRemovedInvitation.users.length": 2}, {"var:bubbleWithRemovedInvitation.users[1].status": "deleted"}],
                        "using": ["maeve"]
                    },

                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubbleWithRemovedInvitation"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "Create a bubble with Maeve, invite Dolores, wait until she accepts the invite then remove Dolores from this bubble and delete it",
                "by": [
                    {
                        "executing": "api:contacts.searchByLogin", 
                        "injecting": ["usr:dolores.email"], 
                        "resulting": "contact", 
                        "expecting": [{"var:contact.loginEmail": "#dabernathy@host-westworld.com"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.inviteContactToBubble", 
                        "injecting": ["var:contact", "var:bubble"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED",
                            "resulting": "invitation>dbId",
                            "using": ["dolores"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [{"var:updatedBubble": "$anObject"}, {"var:updatedBubble.users": "$anArray"}, {"var:updatedBubble.users[0].status": "invited"}, {"var:updatedBubble.users[0].contact.loginEmail": "#dabernathy@host-westworld.com"}, {"var:updatedBubble.users.length": 1}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:invitation.dbId"], 
                        "resulting": "bubbleInvited", 
                        "expecting": [{"var:bubbleInvited": "$anObject"}, {"var:bubbleInvited": "$defined"}, {"var:bubbleInvited.status": "invited"}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.acceptInvitationToJoinBubble", 
                        "injecting": ["var:bubbleInvited"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleAccepted>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleAccepted.dbId"], 
                        "resulting": "bubbleAccepted", 
                        "expecting": [{"var:bubbleAccepted.users.length": 2}, {"var:bubbleAccepted.users[1].status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.removeContactFromBubble", 
                        "injecting": ["var:contact", "var:bubbleAccepted"],
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleContactRemoved>dbId",
                            "using": ["maeve"]
                        }, 
                        "resulting": "bubbleNoContact", 
                        "expecting": [{"var:bubbleNoContact": "$anObject"}, {"var:bubbleNoContact": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleContactRemoved.dbId"], 
                        "resulting": "bubbleContactRemoved", 
                        "expecting": [{"var:bubbleContactRemoved.users.length": 2}, {"var:bubbleContactRemoved.users[1].status": "unsubscribed"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubbleContactRemoved"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "Create a bubble with Maeve, invite Dolores, wait until she declines the invite then remove Dolores from this bubble and delete it",
                "by": [
                    {
                        "executing": "api:contacts.searchByLogin", 
                        "injecting": ["usr:dolores.email"], 
                        "resulting": "contact", 
                        "expecting": [{"var:contact.loginEmail": "#dabernathy@host-westworld.com"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.inviteContactToBubble", 
                        "injecting": ["var:contact", "var:bubble"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED",
                            "resulting": "invitation>dbId",
                            "using": ["dolores"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [{"var:updatedBubble": "$anObject"}, {"var:updatedBubble.users": "$anArray"}, {"var:updatedBubble.users[0].status": "invited"}, {"var:updatedBubble.users[0].contact.loginEmail": "#dabernathy@host-westworld.com"}, {"var:updatedBubble.users.length": 1}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:invitation.dbId"], 
                        "resulting": "bubbleInvited", 
                        "expecting": [{"var:bubbleInvited": "$anObject"}, {"var:bubbleInvited": "$defined"}, {"var:bubbleInvited.status": "invited"}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.declineInvitationToJoinBubble", 
                        "injecting": ["var:bubbleInvited"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleAccepted>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleAccepted.dbId"], 
                        "resulting": "bubbleAccepted", 
                        "expecting": [{"var:bubbleAccepted.users.length": 2}, {"var:bubbleAccepted.users[1].status": "rejected"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.removeContactFromBubble", 
                        "injecting": ["var:contact", "var:bubbleAccepted"], 
                        "resulting": "bubbleNoContact", 
                        "expecting": [{"var:bubbleNoContact": "$anObject"}, {"var:bubbleNoContact": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubbleNoContact"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "Create a bubble with Maeve, invite Dolores, wait until she accepts the invite then wait until Dolores leaves the bubble by herself and finally delete the bubble",
                "by": [
                    {
                        "executing": "api:contacts.searchByLogin", 
                        "injecting": ["usr:dolores.email"], 
                        "resulting": "contact", 
                        "expecting": [{"var:contact.loginEmail": "#dabernathy@host-westworld.com"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.inviteContactToBubble", 
                        "injecting": ["var:contact", "var:bubble"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED",
                            "resulting": "invitation>dbId",
                            "using": ["dolores"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [{"var:updatedBubble": "$anObject"}, {"var:updatedBubble.users": "$anArray"}, {"var:updatedBubble.users[0].status": "invited"}, {"var:updatedBubble.users[0].contact.loginEmail": "#dabernathy@host-westworld.com"}, {"var:updatedBubble.users.length": 1}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:invitation.dbId"], 
                        "resulting": "bubbleInvited", 
                        "expecting": [{"var:bubbleInvited": "$anObject"}, {"var:bubbleInvited": "$defined"}, {"var:bubbleInvited.status": "invited"}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.acceptInvitationToJoinBubble", 
                        "injecting": ["var:bubbleInvited"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleAccepted>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "exe:pause", 
                        "duration": [3000]
                    },
                    {
                        "executing": "api:bubbles.leaveBubble", 
                        "injecting": ["var:bubbleInvited"],
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleLeavedRef>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": "bubbleLeaved", 
                        "expecting": [{"var:bubbleLeaved": "$anObject"}, {"var:bubbleLeaved.status": "unsubscribed"}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleLeavedRef.dbId"], 
                        "resulting": "bubbleLeaved", 
                        "expecting": [{"var:bubbleLeaved.users.length": 2}, {"var:bubbleLeaved.users[1].status": "unsubscribed"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubbleLeaved"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
            "it": {
                "should": "Create a bubble with Maeve, invite Dolores, wait until she accepts the invite, send a message to the bubble then wait until Dolores receives it and finally delete the bubble",
                "by": [
                    {
                        "executing": "api:contacts.searchByLogin", 
                        "injecting": ["usr:dolores.email"], 
                        "resulting": "contact", 
                        "expecting": [{"var:contact.loginEmail": "#dabernathy@host-westworld.com"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.inviteContactToBubble", 
                        "injecting": ["var:contact", "var:bubble"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED",
                            "resulting": "invitation>dbId",
                            "using": ["dolores"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [{"var:updatedBubble": "$anObject"}, {"var:updatedBubble.users": "$anArray"}, {"var:updatedBubble.users[0].status": "invited"}, {"var:updatedBubble.users[0].contact.loginEmail": "#dabernathy@host-westworld.com"}, {"var:updatedBubble.users.length": 1}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:invitation.dbId"], 
                        "resulting": "bubbleInvited", 
                        "expecting": [{"var:bubbleInvited": "$anObject"}, {"var:bubbleInvited": "$defined"}, {"var:bubbleInvited.status": "invited"}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.acceptInvitationToJoinBubble", 
                        "injecting": ["var:bubbleInvited"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleAcceptedRef>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": "updatedBubble", 
                        "expecting": [],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "exe:pause", 
                        "duration": [3000]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleAcceptedRef.dbId"], 
                        "resulting": "bubbleWithDolores", 
                        "expecting": [{"var:bubbleWithDolores.users.length": 2}, {"var:bubbleWithDolores.users[1].status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:im.sendMessageToBubble", 
                        "injecting": ["var:bubbleWithDolores", "Hello Dolores from this bubble!"],
                        "waiting": {
                            "forEvent": "api:conversations.RAINBOW_ONCONVERSATIONSCHANGED",
                            "resulting": "conversation>id",
                            "using": ["dolores"]
                        }, 
                        "resulting": "messageSent", 
                        "expecting": [{"var:messageSent": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:conversations.getConversationById", 
                        "injecting": ["var:conversation.id"], 
                        "resulting": "bubbleConversationWithMaeve", 
                        "expecting": [{"var:bubbleConversationWithMaeve": "$defined"}, {"var:bubbleConversationWithMaeve.messages.length": 1}, {"var:bubbleConversationWithMaeve.messages[0].data": "Hello Dolores from this bubble!"}, {"var:bubbleConversationWithMaeve.messages[0].receiptStatus": 4}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:conversations.getConversationByBubbleId", 
                        "injecting": ["var:bubbleInvited.dbId"], 
                        "resulting": "bubbleConversationWithMaeveSame", 
                        "expecting": [{"var:bubbleConversationWithMaeveSame": "$defined"}, {"var:bubbleConversationWithMaeveSame.messages.length": 1}, {"var:bubbleConversationWithMaeveSame.messages[0].data": "Hello Dolores from this bubble!"}, {"var:bubbleConversationWithMaeveSame.messages[0].receiptStatus": 4}],
                        "using": ["dolores"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubbleWithDolores"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    }
                ]
            }
        },
        {
             "it": {
                "should": "Create a bubble with Maeve, update the description, wait for the server confirmation and finally delete it",
                "by": [
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble", "A description"], 
                        "resulting": "bubble", 
                        "expecting": [{"var:bubble": "$anObject"}, {"var:bubble.jid": "$defined"}, {"var:bubble.name": "A bubble"}, {"var:bubble.desc": "A description"}, {"var:bubble.owner": true}, {"var:bubble.status": "accepted"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "bubbleFound", 
                        "expecting": [{"var:bubbleFound": "$anObject"}, {"var:bubbleFound": "$defined"}, {"var:bubbleFound.desc": "A description"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.updateDescriptionForBubble", 
                        "injecting": ["my new description", "var:bubbleFound"], 
                        "waiting": {
                            "forEvent": "api:bubbles.RAINBOW_ONBUBBLEUPDATED",
                            "resulting": "bubbleUpdated>dbId",
                            "using": ["maeve"]
                        },
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubbleUpdated.dbId"], 
                        "resulting": "bubbleModified", 
                        "expecting": [{"var:bubbleModified": "$anObject"}, {"var:bubbleModified.desc": "my new description"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubble"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    }
                ]
            }
        } ,
        {
            "it": {
                "should": "Create a bubble with Maeve, check that the bubble is well created modify Custon Data and then delete it",
                "by": [
                    {
                        "executing": "api:bubbles.createBubble", 
                        "injecting": ["A bubble for customData", "A description fot customData", false], 
                        "resulting": "bubble", 
                        "expecting": [
                            {"var:bubble": "$anObject"}, 
                            {"var:bubble.jid": "$defined"}, 
                            {"var:bubble.name": "A bubble for customData"}, 
                            {"var:bubble.desc": "A description fot customData"}, 
                            {"var:bubble.owner": true}, 
                            {"var:bubble.status": "accepted"}
                        ],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "bubbleFounded", 
                        "expecting": [{"var:bubbleFounded": "$anObject"}, {"var:bubbleFounded": "$defined"}],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.updateCustomDataForBubble", 
                        "injecting": ["obj:{ \"key1\" : \"123\", \"key2\" : \"a string\" }", "var:bubble"], 
                        "resulting": "updatedBubble", 
                        "expecting": [{"var:updatedBubble.customData": "$anObject"}, {"var:updatedBubble.customData.key1": "123"}, {"var:updatedBubble.customData.key2": "a string"} ],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteCustomDataForBubble", 
                        "injecting": ["var:updatedBubble"], 
                        "resulting": "bubbleWithEmptyCustomData", 
                        "expecting": [{"var:bubbleWithEmptyCustomData.customData": "$anObject"}, {"var:bubbleWithEmptyCustomData.customData.key1": "$notDefined"}, {"var:bubbleWithEmptyCustomData.customData.key2": "$notDefined"} ],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.deleteBubble", 
                        "injecting": ["var:bubble"], 
                        "resulting": null, 
                        "expecting": [],
                        "using": ["maeve"]
                    },
                    {
                        "executing": "api:bubbles.getBubbleById", 
                        "injecting": ["var:bubble.dbId"], 
                        "resulting": "deletedBubble", 
                        "expecting": [{"var:deletedBubble": "$notDefined"}],
                        "using": ["maeve"]
                    }
                ]
            }
        }
    ]
}